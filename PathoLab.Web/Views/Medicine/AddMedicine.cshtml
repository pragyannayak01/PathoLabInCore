@{

    Layout = "~/Views/Shared/_LayoutDynamic.cshtml";
}

<div class="page-title">
    <div class="title-details">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb p-0 mb-0 bg-transparent" id="navigation">
            </ol>
        </nav>
    </div>
</div>
<div class="row">
    <div class="col-md-12 col-sm-12">
        <div class="card">
            <div class="card-header">
                <ul class="nav nav-tabs nav-fill" role="tablist">
                    <a class="nav-item nav-link active" asp-controller="Medicine" asp-action="AddMedicine">Add</a>
                    <a class="nav-item nav-link " asp-controller="Medicine" asp-action="ViewMedicine">View</a>
                </ul>
                <div class="indicatorslist">
                    <a title="" href="javascript:void(0)" id="backIcon" data-toggle="tooltip" data-placement="top" data-original-title="Back"><i class="icon-arrow-left1"></i></a>
                    <p class="ml-2">(*) Indicates mandatory </p>
                </div>
            </div>
            <!-- BASIC FORM ELEMENTS -->
            <!--===================================================-->
            <div class="card-body">
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Catagory Name <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <select id="Catid" class="form-control" onchange="GetAllSubCatByCId()" asp-items="@(new SelectList(ViewBag.Catagory,"CatagoryId","CatagoryName")) ">
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label">SubCatagory Name <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <select id="subCat" class="form-control">
                            <option value="0">Select</option>
                        </select>
                    </div>
                </div>


                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Unit Name <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <select id="UnitName" class="form-control" asp-items="@(new SelectList(ViewBag.UnitName,"UnitId","UnitName"))">
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Brand Name <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <select id="BrandName" class="form-control" asp-items="@(new SelectList(ViewBag.BrandName,"BrandId","BrandName"))">
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">HSN CODE <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <select id="ddlHSnCod" class="form-control" asp-items="@(new SelectList(ViewBag.ddlHSnCodEName,"HsnId","ddlHSnCode"))">
                        </select>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Name <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="Name" class="form-control" onchange="NamevalidationC('Name','lblErrorName')" />
                        <span id="lblErrorName" style="color:red"></span>
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Short Name<span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="SName" class="form-control" onchange="NamevalidationC('Name','lblErrorNamee')" />
                        <span id="lblErrorNamee" style="color:red"></span>
                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Product Code<span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="PCode" type="email" class="form-control" />

                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">MRP<span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="MRP" type="number" class="form-control" />
                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Expiry Date <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="exdate" type="date" class="form-control" />

                    </div>
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Manufacture Date <span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <input id="mfdate" type="date" class="form-control" />

                    </div>
                </div>

                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label" for="RegstrationNo">Description<span class="text-danger">*</span></label>
                    <div class="col-12 col-md-6 col-xl-4">
                        <textarea id="desc" class="form-control"></textarea>


                    </div>
                </div>
                <div class="form-group col-md-4">

                    <input id="id" class="form-control" hidden />
                </div>
                <div class="form-group row">
                    <label class="col-12 col-md-2 col-xl-2 control-label"></label>
                    <div class="col-12 col-md-6 col-xl-4 justify-content-center">
                        <button class="btn btn-primary mb-1" id="btnSubmit">Submit</button>
                        <button class="btn btn-danger mb-1" id="btnCancel">Reset</button>
                        @*<button class="btn btn-danger mb-1" id="btnCancel11" disabled>Resetttt</button>*@


                    </div>
                </div>
            </div>
            <div class="modal fade" id="SubmitModal" tabindex="1" role="dialog"
                 aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5>Customer Details</h5>
                        </div>
                        <div class="modal-body">
                            <h6 class="modalMsg"></h6>
                        </div>
                        <div class="modal-footer">
                            <input type="submit" class="btn btn-info btn-sm submitConfirm hbtn" value="Yes" styk="display:none" />
                            <button type="button" class="btn btn-danger btn-sm No hbtn" data-dismiss="modal" aria-label="Close">No</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="SuccessModal" tabindex="1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="resultMsg" style="color:blue"></h5>
                        </div>
                        <div class="modal-body">
                            <h5 class="msgsuccess"></h5>
                        </div>
                        <div class="modal-footer">
                            <a class="btn btn-danger btnok" asp-controller="Medicine" asp-action="ViewMedicine">Close</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="UnSuccessModal" tabindex="1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="resultMsg" style="color:blue"></h5>
                        </div>
                        <div class="modal-body">
                            <h5 class="msgunsuccess"></h5>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-danger btn-sm No hbtn" data-dismiss="modal" @*aria-label="Close"*@>Close</button>

                        </div>
                    </div>
                </div>
            </div>

            <!--===================================================-->
            <!-- END BASIC FORM ELEMENTS -->
        </div>
    </div>

    <script type="text/javascript" src="http://localhost/acrilart/javascript/jquery-1.6.4.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/jquery-1.2.6.min.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/jquery-ui-personalized-1.5.2.packed.js"></script>
    <script language="JavaScript" type="text/javascript" src="/js/sprinkle.js"></script>
    <script src="~/validation/validation.js"></script>

    <script src="~/validation/validation.js"></script>
    <script>
    $(document).ready(function () {
        //breadcumb
        loadNavigation('Add Medicine', 'gldata', 'plsubmission', 'Add Medicine', '', 'Add Medicine');
        var id = getUrlVars()["id"];
        var catid = getUrlVars()["catid"];
        if (id != undefined) {
            $("#btnSubmit").html("Update");
            $("#btnCancel").html("Cancel");


            Edit(id,catid);
        }
    });

        function GetAllSubCatByCId() {
          
            $.ajax({
                url: "/Medicine/GetSubCatByCId?HospitalID=" + $('#Catid').val(),
                type: "GET",
                success: function (result) {
                    data = JSON.parse(result);
                    var v = "<option value='0'>--Select--</option>";
                    $.each(data, function (i, item) {
                        v += "<option value=" + item.SubCatagoryId + ">" + item.SubCatagoryName + "</option>";
                    });
                    $("#subCat").html(v);
                },
                error: function (error) {
                    jsonValue = jQuery.parseJSON(error.responseText);
                    bootbox.alert("Error : " + jsonValue);
                }
            });
        }





    function validate(){
        if ($('#Catid').val() == "0") {
            $('.msgunsuccess').text('Please Select Catagory!');
            $('#Catid').focus();
            $('#UnSuccessModal').modal('show');

            //alert("Please Select Catagory !");
           
            return false;

        }
        else if ($('#subCat').val() == "0") {
            $('.msgunsuccess').text('Please Select SubCatagory!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Select SubCatagory !");
            $('#subCat').focus();
            return false;

        }
        else if ($('#UnitName').val() == "0") {
            $('.msgunsuccess').text('Please Select Unit Name!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Select Unit Name !");
            $('#UnitName').focus();
            return false;

        }
        else if ($('#BrandName').val() == "0") {
            $('.msgunsuccess').text('Please Select Brand Name!');
            $('#UnSuccessModal').modal('show');

           // alert("Please Select Brand Name !");
            $('#BrandName').focus();
            return false;

        }
        else if ($('#ddlHSnCod').val() == "0") {
            $('.msgunsuccess').text('Please Select HSN CODE!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Select HSN CODE !");
            $('#ddlHSnCod').focus();
            return false;

        }
        else if ($('#Name').val() == "") {
            $('.msgunsuccess').text('Please Enter Name!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Enter Name!");
            $('#Name').focus();
            return false;

        }
        else if ($('#SName').val() == "") {
            $('.msgunsuccess').text('Please Enter Short Name!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Enter Short Name!");
            $('#SName').focus();
            return false;

        }
        else if ($('#PCode').val() == "") {
            $('.msgunsuccess').text('Please Enter Product Code!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Enter Product Code!");
            $('#PCode').focus();
            return false;

        }
        else if ($('#MRP').val() == "") {
            $('.msgunsuccess').text('Please Enter MRP Rate!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Enter MRP Rate !");
            $('#MRP').focus();
            return false;

        }
        else if ($('#exdate').val() == "") {
            $('.msgunsuccess').text('Please Choose Experi Date!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Choose Experi Date !");
            $('#exdate').focus();
            return false;

        }
        else if ($('#mfdate').val() == "") {
            $('.msgunsuccess').text('Please Choose ManuFacture Date!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Choose ManuFacture Date!");
            $('#mfdate').focus();
            return false;

        }

        else if ($('#desc').val() == "") {
            $('.msgunsuccess').text('Please Enter Description!');
            $('#UnSuccessModal').modal('show');

            //alert("Please Enter Description!");
            $('#desc').focus();
            return false;

        }
       
        else
            return true;
    }


    $("#btnCancel").click(function () {
       
        if ($("#id").val() != '') {
            window.location.href = "/Medicine/ViewMedicine";
        }
        else
            reset();
    })

    function reset() {
        $('#id').val("");
        $("#Name").val("");
        $("#SName").val("");
        $("#PCode").val("");
        $("#MRP").val("");
        $("#exdate").val("");
        $("#mfdate").val("0");
        $("#desc").val("");
       
        $("#subCat").val("0");
        $("#Catid").val("0");
        $("#ddlHSnCod").val("0");
        $("#UnitName").val("0");
        $("#BrandName").val("0");
        }
        $("#btnSubmit").click(function () {
            //var chkValidation = validate();
            if (validate() == true) {



                $('.modalMsg').text('Are you sure to save the details ?');
                $('.submitConfirm').css('display', 'block');
                $('#SubmitModal').modal("show");


            }
        });
        $(".submitConfirm").click(function () {
            var doc = {
                Id: $("#id").val(),
                SubCatagoryId: $("#subCat").val(),
                CatagoryId: $("#Catid").val(),
                Name: $("#Name").val(),
                ShortName: $("#SName").val(),
                ProductCode: $("#PCode").val(),
                MRP: $("#MRP").val(),
                HsnId: $("#ddlHSnCod").val(),
                Expiry: $("#exdate").val(),
                Manufacture: $("#mfdate").val(),
                Description: $("#desc").val(),
                UnitId: $("#UnitName").val(),
                BrandId: $("#BrandName").val(),

            };

            if (validate()) {

              
                    $.ajax({
                        url: "/Medicine/Add",
                        data: doc,
                        type: "POST",
                        success: function (result) {
                            if (result == "Record Saved Successfully") {
                                $('.modalMsg').text('');
                                $('#SubmitModal').modal("hide");
                                $('.msgsuccess').text('Data Saved successfully.');
                                $('#SuccessModal').modal('show');
                                //alert(result)
                                //window.location.href = "/RegistrationUser/GetAllUsers";

                            }
                            else if (result == "Record Updated Successfully") {
                                $('.modalMsg').text('');
                                $('#SubmitModal').modal("hide");
                                $('.msgsuccess').text('Data Updated successfully.');
                                $('#SuccessModal').modal('show');
                            }

                            else {
                                $('.modalMsg').text('');
                                $('#SubmitModal').modal("hide");
                                $('.msgunsuccess').text('Data Already Exits');
                                $('#UnSuccessModal').modal('show');
                            }

                        },
                        error: function (errormessage) {
                            alert(errormessage.responseText);
                        }
                    });
                
            }
        });
              
            
        
       
  
    function Edit(id,catid) {
        $.ajax({
            url: "/Medicine/MedicineGetById?id=" + id,
            typr: "GET",
            contentType: "application/json;charset=UTF-8",
            dataType: "json",
            success: function (result) {
                $('#id').val(result.Id );
                $("#Catid").val(result.CatagoryId);

                $.ajax({
                    url: "/Medicine/GetSubCatByCId?HospitalID=" + catid,
                    type: "GET",
                    success: function (res) {
                        data = JSON.parse(res);
                        var v = "<option value='0'>--Select--</option>";
                        $.each(data, function (i, item) {
                            v += "<option value=" + item.SubCatagoryId + ">" + item.SubCatagoryName + "</option>";
                      });
                        $("#subCat").html(v);
                        $("#subCat").val(result.SubCatagoryId);
                    },
                    error: function (error) {
                        jsonValue = jQuery.parseJSON(error.responseText);
                        bootbox.alert("Error : " + jsonValue);
                    }
                });






               
                $("#Name").val(result.Name);
                $("#SName").val(result.ShortName);
                $("#PCode").val(result.ProductCode);
                $("#MRP").val(result.MRP);
                $("#ddlHSnCod").val(result.HsnId);
                $("#exdate").val(result.Expiry);
                $("#mfdate").val(result.Manufacture);
                $("#desc").val(result.Description);
                $("#UnitName").val(result.UnitId);
                $("#BrandName").val(result.BrandId);
             
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });

    }


    </script>
